<div class="container">
  <h2>Editar Ruta</h2>
  <div class="header-actions">
    <button class="btn volver-btn" (click)="volverInicio()">Volver a Inicio</button>
    <button class="btn" (click)="mostrarFormulario()">Agregar Ciudad</button>
  </div>

  <div *ngIf="mostrarFormularioFlag" class="form-container">
    <form (submit)="agregarCiudad()">
      <div class="form-group">
        <label for="nombre">Nombre de la nueva ciudad:</label>
        <input type="text" #nombre id="nombre" placeholder="Nombre de la ciudad" required />
      </div>

      <div class="form-group">
        <label for="latitud">Latitud:</label>
        <input type="number" #latitud id="latitud" placeholder="Latitud" step="0.00001" required />
      </div>

      <div class="form-group">
        <label for="longitud">Longitud:</label>
        <input type="number" #longitud id="longitud" placeholder="Longitud" step="0.00001" required />
      </div>

      <div class="form-group">
        <label for="ciudad1">Conecta con Ciudad 1:</label>
        <select #ciudad1 id="ciudad1" (change)="onCiudad1Change(ciudad1.value)" required>
          <option *ngFor="let ciudad of ciudades" [value]="ciudad.name">{{ ciudad.name }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="distancia1">Distancia a Ciudad 1:</label>
        <input type="number" #distancia1 id="distancia1" placeholder="Distancia a Ciudad 1" step="0.1" required />
      </div>

      <div class="form-group">
        <label for="ciudad2">Conecta con Ciudad 2 (opcional):</label>
        <select #ciudad2 id="ciudad2" [disabled]="!ciudad1Selected">
          <option value="">-- Ninguna --</option>
          <option *ngFor="let ciudad of ciudadesRelacionadas" [value]="ciudad.name">{{ ciudad.name }}</option>
        </select>
      </div>

      <button type="submit" class="btn">Agregar Ciudad</button>
    </form>
  </div>

  <table>
    <thead>
      <tr>
        <th>Ciudad</th>
        <th>Vecinos</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let ciudad of ciudades">
        <td>{{ ciudad.name }}</td>
        <td>
          <ul>
            <li *ngFor="let vecino of ciudad.vecinos | keyvalue">
              {{ vecino.key }}: {{ vecino.value }} km
            </li>
          </ul>
        </td>
        <td>
          <button class="btn btn-eliminar" (click)="abrirConfirmacionEliminar(ciudad)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

 <!-- Modal de confirmación de eliminación -->
 <div class="modal" [ngClass]="{'show': showConfirmModal}">
  <div class="modal-content">
    <h3>¿Estás seguro de que deseas eliminar esta ciudad?</h3>
    <p>Esta acción no puede deshacerse.</p>
    <div class="modal-actions">
      <button class="btn btn-confirmar" (click)="eliminarCiudad(ciudadToDelete)">Confirmar</button>
      <button class="btn btn-cancelar" (click)="closeConfirmModal()">Cancelar</button>
    </div>
  </div>
</div>

<!-- Modal para eliminar nodo o relación -->
<div class="modal" [ngClass]="{'show': showModal}">
  <div class="modal-content">
    <h3>Seleccionar acción</h3>
    <button (click)="eliminarNodo()">Confirmar Eliminación de Nodo</button>
    <button (click)="actionType = 'relationship'">Eliminar Relación</button>

    <div *ngIf="actionType === 'relationship'">
      <h4>Relaciones de {{ ciudadToDelete?.name }}</h4>
      <ul>
        <li *ngFor="let relacion of ciudadRelaciones">
          <button (click)="eliminarRelacion(relacion)">Eliminar relación con {{ relacion.name }}</button>
        </li>
      </ul>
    </div>

    <div *ngIf="actionType === 'node'">
    </div>

    <button class="btn" (click)="closeModal()">Cerrar</button>
  </div>
</div>

</div>